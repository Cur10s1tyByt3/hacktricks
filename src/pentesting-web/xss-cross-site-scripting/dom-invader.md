# DOM Invader

{{#include ../../banners/hacktricks-training.md}}

## DOM Invader

DOM Invader es una herramienta del navegador instalada en **el navegador Chromium integrado de Burp Suite**. Ayuda a **detectar XSS en el DOM y otras vulnerabilidades del lado del cliente** (contaminación de prototipos, clobbering del DOM, etc.) al **instrumentar automáticamente fuentes y sumideros de JavaScript**. La extensión se incluye con Burp y solo necesita ser habilitada.

DOM Invader añade una pestaña al panel de DevTools del navegador que te permite:

1. **Identificar sumideros controlables** en tiempo real, incluyendo contexto (atributo, HTML, URL, JS) y saneamiento aplicado.
2. **Registrar, editar y reenviar `postMessage()` mensajes web**, o dejar que la extensión los mutile automáticamente.
3. **Detectar fuentes de contaminación de prototipos del lado del cliente y escanear cadenas gadget→sumidero**, generando PoCs sobre la marcha.
4. **Encontrar vectores de clobbering del DOM** (por ejemplo, colisiones de `id` / `name` que sobrescriben variables globales).
5. **Ajustar el comportamiento** a través de una rica interfaz de configuración (canario personalizado, auto-inyección, bloqueo de redirecciones, listas de fuentes/sumideros, etc.).

---

### 1. Habilítalo

<figure><img src="../../images/image (1129).png" alt=""><figcaption></figcaption></figure>

1. Abre **Proxy ➜ Interceptar ➜ Abrir navegador** (el navegador integrado de Burp).
2. Haz clic en el logo de **Burp Suite** (en la parte superior derecha). Si está oculto, haz clic primero en la pieza de rompecabezas.
3. En la pestaña **DOM Invader**, activa **Habilitar DOM Invader** y presiona **Recargar**.
4. Abre DevTools ( `F12` / Clic derecho ➜ Inspeccionar ) y acóplalo. Aparece un nuevo panel de **DOM Invader**.

> Burp recuerda el estado por perfil. Desactívalo en *Configuración ➜ Herramientas ➜ Navegador de Burp ➜ Almacenar configuraciones...* si es necesario.

### 2. Inyectar un Canario

Un **canario** es una cadena de marcador aleatorio (por ejemplo, `xh9XKYlV`) que DOM Invader rastrea. Puedes:

* **Copiar** y inyectarlo manualmente en parámetros, formularios, marcos de Web-Socket, mensajes web, etc.
* Usar los botones **Inyectar parámetros URL / Inyectar formularios** para abrir una nueva pestaña donde el canario se añade automáticamente a cada clave/valor de consulta o campo de formulario.
* Buscar un **canario vacío** para revelar todos los sumideros independientemente de su explotabilidad (genial para reconocimiento).

#### Canario personalizado (2025+)

Burp 2024.12 introdujo **Configuraciones de Canario** (logo de Burp ➜ DOM Invader ➜ Canario). Puedes:

* **Aleatorizar** o establecer una **cadena personalizada** (útil para pruebas en múltiples pestañas o cuando el valor predeterminado aparece naturalmente en la página).
* **Copiar** el valor al portapapeles.
* Los cambios requieren **Recargar**.

---

### 3. Mensajes web (`postMessage`)

La sub-pestaña **Mensajes** registra cada llamada a `window.postMessage()`, mostrando el uso de `origen`, `fuente` y `datos`.

• **Modificar y reenviar**: haz doble clic en un mensaje, edita `datos` y presiona **Enviar** (similar a Burp Repeater).

• **Auto-fuzz**: habilita **Intercepción de Postmessage ➜ Auto-mutación** en la configuración para permitir que DOM Invader genere cargas útiles basadas en el canario y las reproduzca al controlador.

Resumen del significado de los campos:

* **origen** – si el controlador valida `event.origin`.
* **datos** – ubicación de la carga útil. Si no se usa, el sumidero es irrelevante.
* **fuente** – validación de referencia de iframe / ventana; a menudo más débil que la verificación de origen estricto.

---

### 4. Contaminación de Prototipos

Habilita en **Configuración ➜ Tipos de ataque ➜ Contaminación de prototipos**.

Flujo de trabajo:

1. **Navegar** – DOM Invader marca **fuentes** de contaminación (`__proto__`, `constructor`, `prototype`) encontradas en URL/consulta/hash o mensajes web JSON.
2. **Probar** – haz clic en *Probar* para abrir una pestaña de PoC donde `Object.prototype.testproperty` debería existir:

```javascript
let obj = {};
console.log(obj.testproperty); // ➜ 'DOM_INVADER_PP_POC'
```
3. **Escanear en busca de gadgets** – DOM Invader fuerza nombres de propiedades y rastrea si alguno termina en sumideros peligrosos (por ejemplo, `innerHTML`).
4. **Explotar** – cuando se encuentra una cadena gadget-sumidero, aparece un botón *Explotar* que encadena fuente + gadget + sumidero para activar una alerta.

Configuraciones avanzadas (icono de engranaje):

* **Eliminar CSP / X-Frame-Options** para mantener los iframes funcionales durante el escaneo de gadgets.
* **Escanear técnicas en marcos separados** para evitar interferencias entre `__proto__` y `constructor`.
* **Desactivar técnicas** individualmente para aplicaciones frágiles.

---

### 5. Clobbering del DOM

Activa **Tipos de ataque ➜ Clobbering del DOM**. DOM Invader monitorea elementos creados dinámicamente cuyos atributos `id`/`name` colisionan con variables globales u objetos de formulario (`<input name="location">` → clobber `window.location`). Se produce una entrada cada vez que un marcado controlado por el usuario conduce a un reemplazo de variable.

---

## 6. Resumen de Configuraciones (2025)

DOM Invader ahora se divide en categorías de **Principal / Tipos de Ataque / Varios / Canario**.

1. **Principal**
* **Habilitar DOM Invader** – interruptor global.
* **Intercepción de postmessage** – activar/desactivar el registro de mensajes; subinterruptores para auto-mutación.
* **Fuentes/Sumideros Personalizados** – *icono de engranaje* ➜ habilitar/deshabilitar sumideros específicos (por ejemplo, `eval`, `setAttribute`) que pueden romper la aplicación.

2. **Tipos de Ataque**
* **Contaminación de prototipos** (con configuraciones por técnica).
* **Clobbering del DOM**.

3. **Varios**
* **Prevención de redirecciones** – bloquear redirecciones del lado del cliente para que la lista de sumideros no se pierda.
* **Punto de interrupción antes de redirigir** – pausar JS justo antes de redirigir para inspección de la pila de llamadas.
* **Inyectar canario en todas las fuentes** – auto-inyectar canario en todas partes; lista de permitidos configurable para fuentes/parámetros.

4. **Canario**
* Ver / aleatorizar / establecer canario personalizado; copiar al portapapeles. Los cambios requieren recarga del navegador.

---

### 7. Consejos y Buenas Prácticas

* **Usar canario distinto** – evitar cadenas comunes como `test`, de lo contrario ocurren falsos positivos.
* **Desactivar sumideros pesados** (`eval`, `innerHTML`) temporalmente si rompen la funcionalidad de la página durante la navegación.
* **Combinar con Burp Repeater y Proxy** – replicar la solicitud/respuesta del navegador que produjo un estado vulnerable y crear URLs de explotación finales.
* **Recordar el alcance del marco** – fuentes/sumideros se muestran por contexto de navegación; las vulnerabilidades dentro de iframes pueden necesitar enfoque manual.
* **Exportar evidencia** – clic derecho en el panel de DOM Invader ➜ *Guardar captura de pantalla* para incluir en informes.

---

## Referencias

- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/settings/canary](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/settings/canary)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/settings/misc](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/settings/misc)

{{#include ../../banners/hacktricks-training.md}}
