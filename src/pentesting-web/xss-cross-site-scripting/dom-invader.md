# DOM Invader

{{#include ../../banners/hacktricks-training.md}}

## DOM Invader

DOM Invader est un outil de navigateur installé dans **le navigateur Chromium intégré de Burp Suite**. Il aide à **détecter les XSS DOM et d'autres vulnérabilités côté client** (pollution de prototype, clobbering DOM, etc.) en **instrumentant automatiquement les sources et les éviers JavaScript**. L'extension est fournie avec Burp et doit simplement être activée.

DOM Invader ajoute un onglet au panneau DevTools du navigateur qui vous permet de :

1. **Identifier les éviers contrôlables** en temps réel, y compris le contexte (attribut, HTML, URL, JS) et la désinfection appliquée.
2. **Journaliser, éditer et renvoyer des messages web `postMessage()`**, ou laisser l'extension les muter automatiquement.
3. **Détecter les sources de pollution de prototype côté client et scanner les chaînes gadget→sink**, générant des PoCs à la volée.
4. **Trouver des vecteurs de clobbering DOM** (par exemple, des collisions `id` / `name` qui écrasent des variables globales).
5. **Affiner le comportement** via une interface utilisateur de paramètres riche (canary personnalisé, injection automatique, blocage de redirection, listes de sources/éviers, etc.).

---

### 1. Activez-le

<figure><img src="../../images/image (1129).png" alt=""><figcaption></figcaption></figure>

1. Ouvrez **Proxy ➜ Intercept ➜ Open Browser** (le navigateur intégré de Burp).
2. Cliquez sur le logo **Burp Suite** (en haut à droite). S'il est caché, cliquez d'abord sur la pièce de puzzle.
3. Dans l'onglet **DOM Invader**, activez **Enable DOM Invader** et appuyez sur **Reload**.
4. Ouvrez DevTools ( `F12` / Clic droit ➜ Inspecter ) et dockez-le. Un nouveau panneau **DOM Invader** apparaît.

> Burp se souvient de l'état par profil. Désactivez-le sous *Settings ➜ Tools ➜ Burp’s browser ➜ Store settings...* si nécessaire.

### 2. Injecter un Canary

Un **canary** est une chaîne de marqueur aléatoire (par exemple, `xh9XKYlV`) que DOM Invader suit. Vous pouvez :

* **Copier** et injecter manuellement dans des paramètres, des formulaires, des cadres Web-Socket, des messages web, etc.
* Utiliser les boutons **Inject URL params / Inject forms** pour ouvrir un nouvel onglet où le canary est ajouté automatiquement à chaque clé/valeur de requête ou champ de formulaire.
* Rechercher un **canary vide** pour révéler tous les éviers indépendamment de leur exploitabilité (idéal pour la reconnaissance).

#### Canary personnalisé (2025+)

Burp 2024.12 a introduit **les paramètres de Canary** (logo Burp ➜ DOM Invader ➜ Canary). Vous pouvez :

* **Randomiser** ou définir une **chaîne personnalisée** (utile pour les tests multi-onglets ou lorsque la valeur par défaut apparaît naturellement sur la page).
* **Copier** la valeur dans le presse-papiers.
* Les changements nécessitent un **Reload**.

---

### 3. Messages web (`postMessage`)

L'onglet **Messages** enregistre chaque appel `window.postMessage()`, montrant l'utilisation de `origin`, `source` et `data`.

• **Modifier & renvoyer** : double-cliquez sur un message, éditez `data`, et appuyez sur **Send** (comme Burp Repeater).

• **Auto-fuzz** : activez **Postmessage interception ➜ Auto-mutate** dans les paramètres pour laisser DOM Invader générer des charges utiles basées sur le canary et les rejouer au gestionnaire.

Récapitulatif de la signification des champs :

* **origin** – si le gestionnaire valide `event.origin`.
* **data** – emplacement de la charge utile. Si inutilisé, l'évier est sans pertinence.
* **source** – validation de la référence iframe / fenêtre ; souvent plus faible que la vérification stricte de l'origine.

---

### 4. Pollution de Prototype

Activez sous **Settings ➜ Attack types ➜ Prototype pollution**.

Flux de travail :

1. **Parcourir** – DOM Invader signale les **sources** de pollution (`__proto__`, `constructor`, `prototype`) trouvées dans l'URL/requête/hash ou les messages web JSON.
2. **Tester** – cliquez sur *Test* pour ouvrir un onglet PoC où `Object.prototype.testproperty` devrait exister :

```javascript
let obj = {};
console.log(obj.testproperty); // ➜ 'DOM_INVADER_PP_POC'
```
3. **Scanner pour des gadgets** – DOM Invader force les noms de propriétés et suit si l'un d'eux se termine dans des éviers dangereux (par exemple, `innerHTML`).
4. **Exploiter** – lorsqu'une chaîne gadget-sink est trouvée, un bouton *Exploit* apparaît qui enchaîne source + gadget + sink pour déclencher une alerte.

Paramètres avancés (icône d'engrenage) :

* **Supprimer CSP / X-Frame-Options** pour garder les iframes fonctionnelles pendant le scan des gadgets.
* **Scanner les techniques dans des cadres séparés** pour éviter les interférences `__proto__` vs `constructor`.
* **Désactiver les techniques** individuellement pour les applications fragiles.

---

### 5. Clobbering DOM

Activez **Attack types ➜ DOM clobbering**. DOM Invader surveille les éléments créés dynamiquement dont les attributs `id`/`name` entrent en collision avec des variables globales ou des objets de formulaire (`<input name="location">` → écrase `window.location`). Une entrée est produite chaque fois qu'un balisage contrôlé par l'utilisateur conduit à un remplacement de variable.

---

## 6. Vue d'ensemble des paramètres (2025)

DOM Invader est maintenant divisé en catégories **Main / Attack Types / Misc / Canary**.

1. **Main**
* **Enable DOM Invader** – interrupteur global.
* **Postmessage interception** – activer/désactiver l'enregistrement des messages ; sous-interrupteurs pour auto-mutation.
* **Custom Sources/Sinks** – *icône d'engrenage* ➜ activer/désactiver des éviers spécifiques (par exemple, `eval`, `setAttribute`) qui peuvent casser l'application.

2. **Attack Types**
* **Prototype pollution** (avec des paramètres par technique).
* **DOM clobbering**.

3. **Misc**
* **Redirect prevention** – bloquer les redirections côté client afin que la liste des éviers ne soit pas perdue.
* **Breakpoint before redirect** – mettre en pause JS juste avant la redirection pour inspecter la pile d'appels.
* **Inject canary into all sources** – injection automatique du canary partout ; liste blanche de sources/paramètres configurable.

4. **Canary**
* Voir / randomiser / définir un canary personnalisé ; copier dans le presse-papiers. Les changements nécessitent un rechargement du navigateur.

---

### 7. Conseils & Bonnes Pratiques

* **Utilisez un canary distinct** – évitez les chaînes communes comme `test`, sinon des faux positifs se produiront.
* **Désactivez temporairement les éviers lourds** (`eval`, `innerHTML`) s'ils cassent la fonctionnalité de la page pendant la navigation.
* **Combinez avec Burp Repeater & Proxy** – répliquez la requête/réponse du navigateur qui a produit un état vulnérable et créez des URL d'exploit finales.
* **N'oubliez pas le contexte de cadre** – les sources/éviers sont affichés par contexte de navigation ; les vulnérabilités à l'intérieur des iframes peuvent nécessiter une attention manuelle.
* **Exportez les preuves** – clic droit sur le panneau DOM Invader ➜ *Save screenshot* à inclure dans les rapports.

---

## Références

- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/settings/canary](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/settings/canary)
- [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/settings/misc](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/settings/misc)

{{#include ../../banners/hacktricks-training.md}}
