# JSON, XML & Yaml Hacking & Issues

{{#include ../banners/hacktricks-training.md}}

## Go JSON Decoder

Se detectaron los siguientes problemas en el Go JSON, aunque tambi√©n podr√≠an estar presentes en otros lenguajes. Estos problemas se publicaron en [**esta entrada de blog**](https://blog.trailofbits.com/2025/06/17/unexpected-security-footguns-in-gos-parsers/).

Los analizadores JSON, XML y YAML de Go tienen una larga trayectoria de inconsistencias y configuraciones predeterminadas inseguras que pueden ser abusadas para **eludir la autenticaci√≥n**, **escalar privilegios** o **exfiltrar datos sensibles**.

### (Un)Marshaling Datos Inesperados

El objetivo es explotar estructuras que permitan a un atacante leer/escribir campos sensibles (por ejemplo, `IsAdmin`, `Password`).

- Example Struct:
```go
type User struct {
Username string `json:"username,omitempty"`
Password string `json:"password,omitempty"`
IsAdmin  bool   `json:"-"`
}
```
- Vulnerabilidades Comunes

1. **Etiqueta faltante** (sin etiqueta = el campo a√∫n se analiza por defecto):
```go
type User struct {
Username string
}
```
Carga √∫til:
```json
{"Username": "admin"}
```
2. **Uso incorrecto de `-`**:
```go
type User struct {
IsAdmin bool `json:"-,omitempty"` // ‚ùå wrong
}
```
Carga √∫til:
```json
{"-": true}
```
‚úîÔ∏è Forma adecuada de bloquear un campo para que no sea (des)serializado:
```go
type User struct {
IsAdmin bool `json:"-"`
}
```
### Diferenciales de Parser

El objetivo es eludir la autorizaci√≥n aprovechando c√≥mo diferentes parsers interpretan la misma carga √∫til de manera diferente, como en:
- CVE-2017-12635: elusi√≥n de Apache CouchDB a trav√©s de claves duplicadas
- 2022: RCE de Zoom 0-click a trav√©s de la inconsistencia del parser XML
- elusi√≥n de SAML de GitLab 2025 a trav√©s de peculiaridades de XML

**1. Campos Duplicados:**
El `encoding/json` de Go toma el **√∫ltimo** campo.
```go
json.Unmarshal([]byte(`{"action":"UserAction", "action":"AdminAction"}`), &req)
fmt.Println(req.Action) // AdminAction
```
Otros analizadores (por ejemplo, Jackson de Java) pueden tomar el **primero**.

**2. Insensibilidad a May√∫sculas y Min√∫sculas:**
Go es insensible a may√∫sculas y min√∫sculas:
```go
json.Unmarshal([]byte(`{"AcTiOn":"AdminAction"}`), &req)
// matches `Action` field
```
Incluso los trucos de Unicode funcionan:
```go
json.Unmarshal([]byte(`{"a‚Ñ™tion≈ø": "bypass"}`), &req)
```
**3. Desajuste entre servicios:**
Imagina:
- Proxy escrito en Go
- Servicio de AuthZ escrito en Python

El atacante env√≠a:
```json
{
"action": "UserAction",
"AcTiOn": "AdminAction"
}
```
- Python ve `UserAction`, lo permite
- Go ve `AdminAction`, lo ejecuta


### Confusi√≥n de Formato de Datos (Pol√≠glotas)

El objetivo es explotar sistemas que mezclan formatos (JSON/XML/YAML) o que fallan abiertamente en errores de an√°lisis como:
- **CVE-2020-16250**: HashiCorp Vault analiz√≥ JSON con un analizador XML despu√©s de que STS devolviera JSON en lugar de XML.

El atacante controla:
- El encabezado `Accept: application/json`
- Control parcial del cuerpo JSON

El analizador XML de Go lo analiz√≥ **de todos modos** y confi√≥ en la identidad inyectada.

- Carga √∫til elaborada:
```json
{
"action": "Action_1",
"AcTiOn": "Action_2",
"ignored": "<?xml version=\"1.0\"?><Action>Action_3</Action>"
}
```
Resultado:
- **Go JSON** parser: `Action_2` (sin distinci√≥n entre may√∫sculas y min√∫sculas + el √∫ltimo gana)
- **YAML** parser: `Action_1` (sensible a may√∫sculas y min√∫sculas)
- **XML** parser: analiza `"Action_3"` dentro de la cadena


### üîê Mitigaciones

| Riesgo                     | Soluci√≥n                              |
|----------------------------|---------------------------------------|
| Campos desconocidos        | `decoder.DisallowUnknownFields()`     |
| Campos duplicados (JSON)   | ‚ùå Sin soluci√≥n en stdlib              |
| Coincidencia sin distinci√≥n| ‚ùå Sin soluci√≥n en stdlib              |
| Datos basura en XML       | ‚ùå Sin soluci√≥n en stdlib              |
| YAML: claves desconocidas  | `yaml.KnownFields(true)`              |


{{#include ../banners/hacktricks-training.md}}
