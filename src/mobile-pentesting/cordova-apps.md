# Cordova Apps

{{#include ../banners/hacktricks-training.md}}

**Pour plus de détails, consultez [https://infosecwriteups.com/recreating-cordova-mobile-apps-to-bypass-security-implementations-8845ff7bdc58](https://infosecwriteups.com/recreating-cordova-mobile-apps-to-bypass-security-implementations-8845ff7bdc58)**. Voici un résumé :

Apache Cordova est reconnu pour permettre le développement d'**applications hybrides** utilisant **JavaScript, HTML et CSS**. Il permet la création d'applications Android et iOS ; cependant, il manque un mécanisme par défaut pour sécuriser le code source de l'application. Contrairement à React Native, Cordova ne compile pas le code source par défaut, ce qui peut entraîner des vulnérabilités de falsification de code. Cordova utilise WebView pour rendre les applications, exposant le code HTML et JavaScript même après avoir été compilé en fichiers APK ou IPA. React Native, en revanche, utilise une VM JavaScript pour exécuter le code JavaScript, offrant une meilleure protection du code source.

### Clonage d'une application Cordova

Avant de cloner une application Cordova, assurez-vous que NodeJS est installé avec d'autres prérequis comme le SDK Android, Java JDK et Gradle. La [documentation](https://cordova.apache.org/docs/en/11.x/guide/cli/#install-pre-requisites-for-building) officielle de Cordova fournit un guide complet pour ces installations.

Considérez un exemple d'application nommée `Bank.apk` avec le nom de package `com.android.bank`. Pour accéder au code source, décompressez `bank.apk` et naviguez vers le dossier `bank/assets/www`. Ce dossier contient le code source complet de l'application, y compris les fichiers HTML et JS. La configuration de l'application se trouve dans `bank/res/xml/config.xml`.

Pour cloner l'application, suivez ces étapes :
```bash
npm install -g cordova@latest
cordova create bank-new com.android.bank Bank
cd bank-new
```
Copiez le contenu de `bank/assets/www` vers `bank-new/www`, en excluant `cordova_plugins.js`, `cordova.js`, `cordova-js-src/` et le répertoire `plugins/`.

Spécifiez la plateforme (Android ou iOS) lors de la création d'un nouveau projet Cordova. Pour cloner une application Android, ajoutez la plateforme Android. Notez que les versions de plateforme de Cordova et les niveaux d'API Android sont distincts. Consultez la [documentation](https://cordova.apache.org/docs/en/11.x/guide/platforms/android/) de Cordova pour plus de détails sur les versions de plateforme et les API Android prises en charge.

Pour déterminer la version appropriée de la plateforme Cordova Android, vérifiez le `PLATFORM_VERSION_BUILD_LABEL` dans le fichier `cordova.js` de l'application d'origine.

Après avoir configuré la plateforme, installez les plugins requis. Le fichier `bank/assets/www/cordova_plugins.js` de l'application d'origine répertorie tous les plugins et leurs versions. Installez chaque plugin individuellement comme indiqué ci-dessous :
```bash
cd bank-new
cordova plugin add cordova-plugin-dialogs@2.0.1
```
Si un plugin n'est pas disponible sur npm, il peut être obtenu depuis GitHub :
```bash
cd bank-new
cordova plugin add https://github.com/moderna/cordova-plugin-cache.git
```
Assurez-vous que toutes les conditions préalables sont remplies avant de compiler :
```bash
cd bank-new
cordova requirements
```
Pour construire l'APK, utilisez la commande suivante :
```bash
cd bank-new
cordova build android — packageType=apk
```
Cette commande génère un APK avec l'option de débogage activée, facilitant le débogage via Google Chrome. Il est crucial de signer l'APK avant l'installation, surtout si l'application inclut des mécanismes de détection de falsification de code.

### Outil d'automatisation

Pour ceux qui cherchent à automatiser le processus de clonage, **[MobSecco](https://github.com/Anof-cyber/MobSecco)** est un outil recommandé. Il simplifie le clonage des applications Android, facilitant les étapes décrites ci-dessus.

---

## Risques de sécurité et vulnérabilités récentes (2023-2025)

L'architecture basée sur des plugins de Cordova signifie que **la plupart de la surface d'attaque se trouve à l'intérieur des plugins tiers et du pont WebView**. Les problèmes suivants ont été activement exploités ou divulgués publiquement au cours des dernières années :

* **Packages NPM malveillants.** En juillet 2024, le package `cordova-plugin-acuant` a été retiré du registre NPM après qu'il a été découvert qu'il déposait du code malveillant lors de l'installation (OSV-ID MAL-2024-7845). Toute machine de développeur ayant exécuté `npm install cordova-plugin-acuant` doit être considérée comme compromise. Auditez `package.json`/`package-lock.json` pour des plugins Cordova inattendus et fixez des versions de confiance. [OSV advisory](/)
* **Deeplinks non validés → XSS/RCE.** `CleverTap Cordova Plugin ≤ 2.6.2` (CVE-2023-2507) ne parvient pas à assainir l'entrée des deeplinks, permettant à un attaquant d'injecter du JavaScript arbitraire qui s'exécute dans le contexte principal de WebView lorsqu'un lien conçu est ouvert. Mettez à jour vers ≥ 2.6.3 ou supprimez les paramètres URI non fiables à l'exécution. [CVE-2023-2507](/)
* **Code de plateforme obsolète.** `cordova-android` ≤ 12 est livré avec targetSdk 33 ou inférieur. À partir de mai 2024, Google Play exige l'API 34, et plusieurs fonctionnalités de durcissement de WebView (par exemple, `exported="false"` généré automatiquement pour les composants) ne sont présentes que dans l'API 34+. Mettez à niveau vers `cordova-android@13.0.0` ou une version ultérieure.

### Vérifications rapides lors d'un pentest

1. **Recherchez `android:debuggable="true"`** dans le `AndroidManifest.xml` décompilé. Les builds débogables exposent le WebView via `chrome://inspect`, permettant une injection JS complète.
2. Passez en revue `config.xml` pour des balises `<access origin="*">` trop permissives ou des balises meta CSP manquantes dans `www/index.html`.
3. Grep `www/` pour `eval(`, `new Function(` ou du HTML construit dynamiquement qui pourrait transformer des contournements CSP en XSS.
4. Identifiez les plugins intégrés dans `plugins/` et exécutez `npm audit --production` ou `osv-scanner --lockfile` pour trouver des CVE connus.

---

## Conseils d'analyse dynamique

### Débogage WebView à distance

Si l'application a été compilée en mode **debug** (ou appelle explicitement `WebView.setWebContentsDebuggingEnabled(true)`), vous pouvez attacher Chrome DevTools :
```bash
adb forward tcp:9222 localabstract:chrome_devtools_remote
google-chrome --new-window "chrome://inspect/#devices"
```
Cela vous donne une console JavaScript en direct, un inspecteur DOM et la possibilité de remplacer des fonctions JavaScript à l'exécution – extrêmement utile pour contourner la logique côté client. (Voir la documentation officielle de Google pour plus de détails.)

### Hooking the JS ⇄ Native bridge with Frida

Le point d'entrée côté Java de la plupart des plugins est `org.apache.cordova.CordovaPlugin.execute(...)`. Hooker cette méthode vous permet de surveiller ou de manipuler les appels effectués depuis JavaScript :
```javascript
// frida -U -f com.vulnerable.bank -l hook.js --no-pause
Java.perform(function () {
var CordovaPlugin = Java.use('org.apache.cordova.CordovaPlugin');
CordovaPlugin.execute.overload('java.lang.String','org.json.JSONArray','org.apache.cordova.CallbackContext').implementation = function(act, args, ctx) {
console.log('[Cordova] ' + act + ' => ' + args);
// Tamper the first argument of a sensitive action
if (act === 'encrypt') {
args.put(0, '1234');
}
return this.execute(act, args, ctx);
};
});
```
---

## Recommandations de durcissement (2025)

* **Mettez à jour vers la dernière plateforme :** `cordova-android@13` (mai 2024) cible l'API 34 et apporte de nouvelles atténuations WebView.
* **Supprimez les artefacts de débogage :** Assurez-vous que `android:debuggable="false"` et évitez d'appeler `setWebContentsDebuggingEnabled` dans les versions de production.
* **Imposez une CSP stricte & AllowList :** Ajoutez une balise `<meta http-equiv="Content-Security-Policy" ...>` dans chaque fichier HTML et restreignez les origines `<access>` dans `config.xml`.
Exemple de CSP minimale qui bloque les scripts en ligne :
```html
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; object-src 'none'; frame-ancestors 'none'">
```
* **Désactivez le trafic en clair :** Dans `AndroidManifest.xml`, définissez `android:usesCleartextTraffic="false"` et/ou fournissez une [network-security-config] qui impose TLS.
* **Hygiène des plugins :**
* Fixez les versions des plugins avec `npm ci` et engagez le `package-lock.json` généré.
* Exécutez périodiquement `npm audit`, `osv-scanner` ou `cordova-check-plugins`.
* **Obfuscation :** Minifiez JavaScript avec Terser/UglifyJS et supprimez les cartes sources des versions de production pour ralentir le reverse engineering occasionnel.

---

## Références

* Apache Cordova – Notes de version de Cordova-Android 13.0.0 (mai 2024)
* OSV-ID MAL-2024-7845 – Code malveillant dans `cordova-plugin-acuant`
* CVE-2023-2507 – CleverTap Cordova Plugin deeplink XSS

{{#include ../banners/hacktricks-training.md}}
