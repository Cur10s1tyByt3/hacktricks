# Cordova Apps

{{#include ../banners/hacktricks-training.md}}

**Para más detalles, consulta [https://infosecwriteups.com/recreating-cordova-mobile-apps-to-bypass-security-implementations-8845ff7bdc58](https://infosecwriteups.com/recreating-cordova-mobile-apps-to-bypass-security-implementations-8845ff7bdc58)**. Este es un resumen:

Apache Cordova es reconocido por permitir el desarrollo de **aplicaciones híbridas** utilizando **JavaScript, HTML y CSS**. Permite la creación de aplicaciones para Android e iOS; sin embargo, carece de un mecanismo predeterminado para asegurar el código fuente de la aplicación. A diferencia de React Native, Cordova no compila el código fuente por defecto, lo que puede llevar a vulnerabilidades de manipulación de código. Cordova utiliza WebView para renderizar aplicaciones, exponiendo el código HTML y JavaScript incluso después de ser compilado en archivos APK o IPA. React Native, en cambio, emplea una VM de JavaScript para ejecutar código JavaScript, ofreciendo mejor protección del código fuente.

### Clonando una Aplicación Cordova

Antes de clonar una aplicación Cordova, asegúrate de que NodeJS esté instalado junto con otros requisitos previos como el SDK de Android, Java JDK y Gradle. La [documentación](https://cordova.apache.org/docs/en/11.x/guide/cli/#install-pre-requisites-for-building) oficial de Cordova proporciona una guía completa para estas instalaciones.

Considera un ejemplo de aplicación llamada `Bank.apk` con el nombre de paquete `com.android.bank`. Para acceder al código fuente, descomprime `bank.apk` y navega a la carpeta `bank/assets/www`. Esta carpeta contiene el código fuente completo de la aplicación, incluidos los archivos HTML y JS. La configuración de la aplicación se puede encontrar en `bank/res/xml/config.xml`.

Para clonar la aplicación, sigue estos pasos:
```bash
npm install -g cordova@latest
cordova create bank-new com.android.bank Bank
cd bank-new
```
Copia el contenido de `bank/assets/www` a `bank-new/www`, excluyendo `cordova_plugins.js`, `cordova.js`, `cordova-js-src/` y el directorio `plugins/`.

Especifica la plataforma (Android o iOS) al crear un nuevo proyecto de Cordova. Para clonar una aplicación de Android, añade la plataforma Android. Ten en cuenta que las versiones de plataforma de Cordova y los niveles de API de Android son distintos. Consulta la [documentación](https://cordova.apache.org/docs/en/11.x/guide/platforms/android/) de Cordova para obtener detalles sobre las versiones de plataforma y las API de Android compatibles.

Para determinar la versión de plataforma de Cordova Android adecuada, verifica el `PLATFORM_VERSION_BUILD_LABEL` en el archivo `cordova.js` de la aplicación original.

Después de configurar la plataforma, instala los plugins requeridos. El archivo `bank/assets/www/cordova_plugins.js` de la aplicación original enumera todos los plugins y sus versiones. Instala cada plugin individualmente como se muestra a continuación:
```bash
cd bank-new
cordova plugin add cordova-plugin-dialogs@2.0.1
```
Si un plugin no está disponible en npm, se puede obtener de GitHub:
```bash
cd bank-new
cordova plugin add https://github.com/moderna/cordova-plugin-cache.git
```
Asegúrate de que se cumplan todos los requisitos previos antes de compilar:
```bash
cd bank-new
cordova requirements
```
Para construir el APK, usa el siguiente comando:
```bash
cd bank-new
cordova build android — packageType=apk
```
Este comando genera un APK con la opción de depuración habilitada, facilitando la depuración a través de Google Chrome. Es crucial firmar el APK antes de la instalación, especialmente si la aplicación incluye mecanismos de detección de manipulación de código.

### Herramienta de Automatización

Para aquellos que buscan automatizar el proceso de clonación, **[MobSecco](https://github.com/Anof-cyber/MobSecco)** es una herramienta recomendada. Simplifica la clonación de aplicaciones Android, facilitando los pasos descritos anteriormente.

---

## Riesgos de Seguridad y Vulnerabilidades Recientes (2023-2025)

La arquitectura basada en plugins de Cordova significa que **la mayor parte de la superficie de ataque se encuentra dentro de plugins de terceros y el puente WebView**. Los siguientes problemas han sido explotados activamente o divulgados públicamente en los últimos años:

* **Paquetes NPM Maliciosos.** En julio de 2024, el paquete `cordova-plugin-acuant` fue eliminado del registro de NPM después de que se descubriera que dejaba caer código malicioso durante la instalación (OSV-ID MAL-2024-7845). Cualquier máquina de desarrollador que ejecutó `npm install cordova-plugin-acuant` debe considerarse comprometida. Audite `package.json`/`package-lock.json` en busca de plugins de Cordova inesperados y fije versiones de confianza. [OSV advisory](/)
* **Deeplinks No Validados → XSS/RCE.** `CleverTap Cordova Plugin ≤ 2.6.2` (CVE-2023-2507) no sanitiza la entrada de deeplink, permitiendo a un atacante inyectar JavaScript arbitrario que se ejecuta en el contexto principal de WebView cuando se abre un enlace manipulado. Actualice a ≥ 2.6.3 o elimine parámetros URI no confiables en tiempo de ejecución. [CVE-2023-2507](/)
* **Código de Plataforma Desactualizado.** `cordova-android` ≤ 12 se envía con targetSdk 33 o inferior. A partir de mayo de 2024, Google Play requiere API 34, y varias características de endurecimiento de WebView (por ejemplo, `exported="false"` auto-generado para componentes) solo están presentes en API 34+. Actualice a `cordova-android@13.0.0` o posterior.

### Comprobaciones Rápidas durante un pentest

1. **Busque `android:debuggable="true"`** en el `AndroidManifest.xml` decompilado. Las compilaciones depurables exponen el WebView a través de `chrome://inspect`, permitiendo inyección completa de JS.
2. Revise `config.xml` en busca de etiquetas `<access origin="*">` demasiado permisivas o falta de meta-tags CSP en `www/index.html`.
3. Grep `www/` en busca de `eval(`, `new Function(` o HTML construido dinámicamente que podría convertir los bypasses de CSP en XSS.
4. Identifique plugins incrustados en `plugins/` y ejecute `npm audit --production` o `osv-scanner --lockfile` para encontrar CVEs conocidos.

---

## Consejos de Análisis Dinámico

### Depuración Remota de WebView

Si la aplicación ha sido compilada en modo **debug** (o llama explícitamente a `WebView.setWebContentsDebuggingEnabled(true)`), puede adjuntar Chrome DevTools:
```bash
adb forward tcp:9222 localabstract:chrome_devtools_remote
google-chrome --new-window "chrome://inspect/#devices"
```
Esto te proporciona una consola de JavaScript en vivo, un inspector de DOM y la capacidad de sobrescribir funciones de JavaScript en tiempo de ejecución, lo cual es extremadamente útil para eludir la lógica del lado del cliente. (Consulta la documentación oficial de Google para más detalles.)

### Hooking the JS ⇄ Native bridge with Frida

El punto de entrada del lado de Java de la mayoría de los plugins es `org.apache.cordova.CordovaPlugin.execute(...)`. Hooking este método te permite monitorear o manipular las llamadas realizadas desde JavaScript:
```javascript
// frida -U -f com.vulnerable.bank -l hook.js --no-pause
Java.perform(function () {
var CordovaPlugin = Java.use('org.apache.cordova.CordovaPlugin');
CordovaPlugin.execute.overload('java.lang.String','org.json.JSONArray','org.apache.cordova.CallbackContext').implementation = function(act, args, ctx) {
console.log('[Cordova] ' + act + ' => ' + args);
// Tamper the first argument of a sensitive action
if (act === 'encrypt') {
args.put(0, '1234');
}
return this.execute(act, args, ctx);
};
});
```
---

## Recomendaciones de Endurecimiento (2025)

* **Actualiza a la última plataforma:** `cordova-android@13` (mayo de 2024) apunta a la API 34 y trae nuevas mitigaciones de WebView.
* **Elimina artefactos de depuración:** Asegúrate de que `android:debuggable="false"` y evita llamar a `setWebContentsDebuggingEnabled` en las versiones de lanzamiento.
* **Imponer un CSP estricto y AllowList:** Agrega una etiqueta `<meta http-equiv="Content-Security-Policy" ...>` en cada archivo HTML y restringe los orígenes de `<access>` en `config.xml`.
Ejemplo de CSP mínimo que bloquea scripts en línea:
```html
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; object-src 'none'; frame-ancestors 'none'">
```
* **Deshabilitar tráfico en texto claro:** En `AndroidManifest.xml` establece `android:usesCleartextTraffic="false"` y/o proporciona un [network-security-config] que imponga TLS.
* **Higiene de plugins:**
* Fija las versiones de los plugins con `npm ci` y compromete el `package-lock.json` generado.
* Ejecuta periódicamente `npm audit`, `osv-scanner` o `cordova-check-plugins`.
* **Ofuscación:** Minifica JavaScript con Terser/UglifyJS y elimina los mapas de origen de las versiones de producción para ralentizar la inversión casual.

---

## Referencias

* Apache Cordova – Notas de la versión de Cordova-Android 13.0.0 (mayo de 2024)
* OSV-ID MAL-2024-7845 – Código malicioso en `cordova-plugin-acuant`
* CVE-2023-2507 – CleverTap Cordova Plugin deeplink XSS

{{#include ../banners/hacktricks-training.md}}
